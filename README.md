# wx-push

å¾®ä¿¡æ¶ˆæ¯æ¨é€æœåŠ¡ï¼ŒåŸºäº [go-wxpush](https://github.com/hezhizheng/go-wxpush)

[æµ‹è¯•å·åœ°å€](https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&t=sandbox/
index)

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¡«å…¥å®é™…å€¼
vim .env
```

### 2. é…ç½®ç”¨æˆ· ID

ç¼–è¾‘ `run.sh` ç¬¬ 9 è¡Œï¼Œå¡«å…¥æ¥æ”¶æ¶ˆæ¯çš„ç”¨æˆ· openidï¼š

```bash
USERID="ç”¨æˆ·1çš„openid,ç”¨æˆ·2çš„openid"
```

### 3. å¯åŠ¨æœåŠ¡

```bash
./run.sh start
```

### 4. å‘é€æ¶ˆæ¯

#### å•ç”¨æˆ·å‘é€

```bash
# ç®€å•æ¶ˆæ¯
./send.sh "è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯"

# è‡ªå®šä¹‰æ ‡é¢˜
./send.sh "æ ‡é¢˜" "å†…å®¹"

# ä»æ–‡ä»¶è¯»å–ï¼ˆé€‚åˆé•¿å†…å®¹ï¼‰
./send.sh -f message.txt
```

#### å¤šç”¨æˆ·å‘é€

âš ï¸ **æ³¨æ„**ï¼šgo-wxpush åŸç”Ÿä¸æ”¯æŒå¤šç”¨æˆ·åŒæ—¶æ¨é€ï¼ˆè™½ç„¶æ–‡æ¡£å£°ç§°æ”¯æŒï¼‰ï¼Œéœ€è¦ä½¿ç”¨ `send_all.sh` è„šæœ¬é€ä¸ªå‘é€ã€‚

```bash
# æ‰¹é‡å‘é€åˆ°æ‰€æœ‰ç”¨æˆ·ï¼ˆä» run.sh è¯»å–ç”¨æˆ·åˆ—è¡¨ï¼‰
./send_all.sh -f message.txt

# æˆ–æŒ‡å®šå†…å®¹
./send_all.sh "æ ‡é¢˜" "å†…å®¹"
```

`send_all.sh` ä¼šè‡ªåŠ¨è¯»å– `run.sh` ä¸­é…ç½®çš„ç”¨æˆ·åˆ—è¡¨ï¼Œé€ä¸ªå‘é€æ¶ˆæ¯å¹¶æ˜¾ç¤ºæ¯ä¸ªç”¨æˆ·çš„å‘é€ç»“æœã€‚

## å‘½ä»¤è¯´æ˜

### æœåŠ¡ç®¡ç†

| å‘½ä»¤               | è¯´æ˜     |
| ------------------ | -------- |
| `./run.sh start`   | å¯åŠ¨æœåŠ¡ |
| `./run.sh stop`    | åœæ­¢æœåŠ¡ |
| `./run.sh restart` | é‡å¯æœåŠ¡ |
| `./run.sh logs`    | æŸ¥çœ‹æ—¥å¿— |
| `./run.sh status`  | æŸ¥çœ‹çŠ¶æ€ |
| `./run.sh pull`    | æ›´æ–°é•œåƒ |

### æ¶ˆæ¯å‘é€

| å‘½ä»¤                             | è¯´æ˜                          |
| -------------------------------- | ----------------------------- |
| `./send.sh "å†…å®¹"`               | å‘é€ç®€å•æ¶ˆæ¯                  |
| `./send.sh "æ ‡é¢˜" "å†…å®¹"`        | å‘é€å¸¦æ ‡é¢˜æ¶ˆæ¯                |
| `./send.sh -f message.txt`       | ä»æ–‡ä»¶è¯»å–å†…å®¹å‘é€            |
| `./send_all.sh -f message.txt`   | æ‰¹é‡å‘é€åˆ°æ‰€æœ‰ç”¨æˆ·            |
| `./smart_send.sh "ç»™æœ‹å‹å‘æ¶ˆæ¯"` | AI æ™ºèƒ½æ¨é€ï¼ˆéœ€é…ç½® API Keyï¼‰ |

## ğŸ¤– AI æ™ºèƒ½æ¨é€

ä½¿ç”¨å¤§æ¨¡å‹è‡ªåŠ¨è¯†åˆ«æ„å›¾ï¼Œæ™ºèƒ½é€‰æ‹©åˆ†ç»„å¹¶å‘é€æ¶ˆæ¯ã€‚

### 1. é…ç½®ç”¨æˆ·åˆ†ç»„

ç¼–è¾‘ `groups.conf` æ–‡ä»¶ï¼š

```bash
# æœ‹å‹
friends=openid1,openid2

# å®¶äºº
family=openid3,openid4

# æ¸¸æˆæ­å­
gamers=openid5

# æ‰€æœ‰äºº
all=openid1,openid2,openid3,openid4,openid5
```

### 2. é…ç½® OpenAI API Key

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export OPENAI_API_KEY="your-api-key"

# æˆ–ç›´æ¥ç¼–è¾‘ smart_send.sh æ–‡ä»¶ä¸­çš„ OPENAI_API_KEY
```

æ”¯æŒä»»ä½•å…¼å®¹ OpenAI API çš„æœåŠ¡ï¼Œå¦‚ï¼š

- OpenAI GPT
- DeepSeek
- é€šä¹‰åƒé—®ï¼ˆQwenï¼‰
- å…¶ä»–æœ¬åœ°æ¨¡å‹ï¼ˆOllama ç­‰ï¼‰

### 3. ä½¿ç”¨ç¤ºä¾‹

```bash
# AI è‡ªåŠ¨è¯†åˆ«å‘é€ç»™æœ‹å‹
./smart_send.sh "ç»™æœ‹å‹å‘ä¸ªå…ƒæ—¦ç¥ç¦"

# é€šçŸ¥å®¶äºº
./smart_send.sh "é€šçŸ¥å®¶äººæ™šä¸Š7ç‚¹èšé¤"

# å‘ç»™æ‰€æœ‰äºº
./smart_send.sh "ç»™å¤§å®¶å‘æ¶ˆæ¯ï¼šæ˜å¤©æ”¾å‡"

# æ¸¸æˆæ­å­
./smart_send.sh "å‘Šè¯‰æ¸¸æˆæ­å­ä»Šæ™š8ç‚¹å¼€é»‘"
```

AI ä¼šè‡ªåŠ¨ï¼š

1. è¯†åˆ«ç›®æ ‡åˆ†ç»„ï¼ˆæœ‹å‹/å®¶äºº/æ¸¸æˆæ­å­/æ‰€æœ‰äººï¼‰
2. æå–æˆ–ç”Ÿæˆåˆé€‚çš„æ ‡é¢˜
3. æå–æ¶ˆæ¯å†…å®¹
4. å‘é€å‰ç¡®è®¤

## å¤šç”¨æˆ·è¯´æ˜

go-wxpush è™½ç„¶æ–‡æ¡£å£°ç§°æ”¯æŒå¤šç”¨æˆ·ï¼Œä½†å®é™…ä¸Šå¹¶æœªå®ç°ã€‚æœ¬é¡¹ç›®æä¾› `send_all.sh` è§£å†³æ­¤é—®é¢˜ï¼š

- **åŸç†**ï¼šè¯»å– `run.sh` ä¸­çš„ç”¨æˆ·åˆ—è¡¨ï¼Œé€ä¸ªå‘æ¯ä¸ªç”¨æˆ·å•ç‹¬å‘é€
- **ä¼˜åŠ¿**ï¼šå¯ä»¥çœ‹åˆ°æ¯ä¸ªç”¨æˆ·çš„å‘é€ç»“æœï¼Œå¤±è´¥æ—¶å¯ä»¥å®šä½å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·
- **ä½¿ç”¨**ï¼šåœ¨ `run.sh` ç¬¬ 9 è¡Œé…ç½®å¤šä¸ªç”¨æˆ·ï¼Œç„¶åç”¨ `send_all.sh` å‘é€å³å¯

## è·å–é…ç½®

[å¾®ä¿¡å…¬ä¼—å¹³å°æµ‹è¯•è´¦å·](https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login)

1. æ‰«ç ç™»å½•è·å– `appid` å’Œ `appsecret`
2. æ–°å¢æ¶ˆæ¯æ¨¡æ¿ï¼Œè·å– `template_id`ï¼ˆæ¨¡æ¿å†…å®¹å¡« `å†…å®¹: {{content.DATA}}`ï¼‰
3. å…³æ³¨æµ‹è¯•å…¬ä¼—å·åï¼Œåœ¨ç”¨æˆ·åˆ—è¡¨è·å– `openid`

## æ¶ˆæ¯æ¨¡æ¿

### æ¶ˆæ¯å†…å®¹æ¨¡æ¿

é¡¹ç›®æä¾›å¤šä¸ªç²¾ç¾çš„æ¶ˆæ¯æ¨¡æ¿ï¼Œå­˜æ”¾åœ¨ `templates/` ç›®å½•ï¼š

| æ¨¡æ¿æ–‡ä»¶               | è¯´æ˜         | ä½¿ç”¨åœºæ™¯               |
| ---------------------- | ------------ | ---------------------- |
| `holiday_greeting.txt` | èŠ‚æ—¥ç¥ç¦     | å…ƒæ—¦ã€æ˜¥èŠ‚ç­‰èŠ‚æ—¥é—®å€™   |
| `server_alert.txt`     | æœåŠ¡å™¨å‘Šè­¦   | CPUã€å†…å­˜ã€ç£ç›˜å‘Šè­¦    |
| `daily_reminder.txt`   | æ¯æ—¥æé†’     | å¾…åŠäº‹é¡¹ã€æ—¥ç¨‹æé†’     |
| `task_complete.txt`    | ä»»åŠ¡å®Œæˆé€šçŸ¥ | å¤‡ä»½å®Œæˆã€è„šæœ¬æ‰§è¡ŒæˆåŠŸ |
| `security_alert.txt`   | å®‰å…¨æé†’     | å¼‚å¸¸ç™»å½•ã€å®‰å…¨è­¦å‘Š     |

### æ¶ˆæ¯è¯¦æƒ…é¡µæ¨¡æ¿

ç‚¹å‡»å¾®ä¿¡æ¶ˆæ¯åè·³è½¬çš„é¡µé¢ï¼Œå­˜æ”¾åœ¨ `html/` ç›®å½•ï¼š

| HTML æ–‡ä»¶            | é£æ ¼     | é¢„è§ˆ                   |
| -------------------- | -------- | ---------------------- |
| `detail.html`        | ç´«è‰²æ¸å˜ | ç°ä»£æ„Ÿï¼Œé€‚åˆé€šçŸ¥ç±»æ¶ˆæ¯ |
| `detail_dark.html`   | æš—é»‘ä¸»é¢˜ | ç§‘æŠ€æ„Ÿï¼Œé€‚åˆç³»ç»Ÿå‘Šè­¦   |
| `detail_simple.html` | ç®€çº¦å¡ç‰‡ | æ¸…æ–°é£ï¼Œé€‚åˆæ—¥å¸¸æé†’   |

### ä½¿ç”¨æ–¹å¼

#### 1. ä½¿ç”¨æ¶ˆæ¯å†…å®¹æ¨¡æ¿

```bash
# ä½¿ç”¨æ¨¡æ¿å‘é€
./send_all.sh -f templates/holiday_greeting.txt
```

#### 2. è‡ªå®šä¹‰è¯¦æƒ…é¡µï¼ˆéƒ¨ç½²åˆ° GitHub Pagesï¼‰

1. **ä¸Šä¼ ä»£ç åˆ° GitHub**
2. **å¯ç”¨ GitHub Pages**ï¼ˆSettings â†’ Pages â†’ Source é€‰æ‹© main åˆ†æ”¯ï¼‰
3. **ä¿®æ”¹ `.env` æ–‡ä»¶**ï¼Œè®¾ç½® `base_url`ï¼š

```bash
# .env æ–‡ä»¶
BASE_URL="https://ä½ çš„ç”¨æˆ·å.github.io/wx-push/html"
```

4. **é‡å¯æœåŠ¡**ï¼š

```bash
./run.sh restart
```

ç°åœ¨ç‚¹å‡»å¾®ä¿¡æ¶ˆæ¯ä¼šè·³è½¬åˆ°ä½ çš„è‡ªå®šä¹‰é¡µé¢ï¼

#### 3. ä» GitHub ç›´æ¥ä½¿ç”¨å†…å®¹æ¨¡æ¿

```bash
# ä» GitHub æ‹‰å–æ¨¡æ¿å‘é€
curl -s https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/wx-push/main/templates/holiday_greeting.txt | ./send_all.sh -f -
```
